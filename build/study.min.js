/**
 * studyjs - A client side A/B tester
 * @version v2.0.4
 * @link https://github.com/dollarshaveclub/study
 * @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
 * @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Study=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=!("undefined"==typeof module||!module.exports),r="ab-tests",o=function(e,t){return Math.random()*(t-e)+e};window.rand=o;var s=function(e,t){for(var n=t.reduce(function(e,t){return e+t}),r=0,s=o(0,n),i=0;i<e.length;i+=1)if(r+=t[i],s<=r)return e[i];return""},i=function(e){return 1===e.length?e[0]:e},u=function(){function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.store,s=void 0===n?o.stores.local:n;e(this,o),this.store=s,this.store.isSupported()||(console.warn("Provided store '"+s.type+"' is not supported. Falling back to 'memory' store"),this.store=o.stores.memory),this.userBuckets={},this.userAssignments={},this.providedTests=[];var i=this.store.get(r);if(i)try{this.userBuckets=JSON.parse(i)}catch(e){this.userBuckets={}}}return t(o,[{key:"define",value:function(e){var t=this,n=e;Array.isArray(e)||(n=[e]),n.forEach(function(e){if(!e.name)throw new Error("Tests must have a name");if(!e.buckets)throw new Error("Tests must have buckets");if(!Object.keys(e.buckets))throw new Error("Tests must have buckets");t.providedTests=t.providedTests.concat(e)})}},{key:"definitions",value:function(){return i(this.providedTests)}},{key:"assign",value:function(e,t){var r=this,o=this.assignments();this.providedTests.forEach(function(i){var u=i.name in r.userBuckets,c=t&&e&&e===i.name,a=e&&i.name!==e,f=null===t,d=void 0;a||(f?d=t:c?d=t:u?d=r.userBuckets[i.name]:!function(){var e=Object.keys(i.buckets),t=[];e.forEach(function(e){var n=i.buckets[e].weight;"undefined"==typeof n&&(n=1),t.push(n)}),d=s(e,t)}(),f?(n||document.body.classList.remove(i.name+"--"+o[i.name]),delete r.userAssignments[i.name]):(n||document.body.classList.add(i.name+"--"+d),r.userAssignments[i.name]=d))}),this.persist(this.userAssignments)}},{key:"assignments",value:function(){return this.userAssignments}},{key:"persist",value:function(e){this.store.set(r,JSON.stringify(e))}}]),o}();return u.stores={local:{type:"local",get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)},isSupported:function(){if("undefined"!=typeof localStorage)return!0;var e=new Date;try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}},memory:function(){var e={};return{type:"memory",get:function(t){return e[t]},set:function(t,n){e[t]=n},isSupported:function(){return!0}}}(),browserCookie:{type:"browserCookie",get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires=expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"},isSupported:function(){return!n}}},u});
