/**
 * studyjs - A client side A/B tester
 * @version v1.1.2
 * @link https://github.com/dollarshaveclub/study
 * @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
 * @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Study=e()}(this,function(){"use strict";function t(t){function e(t,e,n){var r=void 0,o=void 0;n?(r=new Date,r.setTime(r.getTime()+24*n*60*60*1e3),o="; expires="+r.toGMTString()):o="",document.cookie=t+"="+(e+o)+"; path=/"}function n(t){var e,n,r=t+"=",o=document.cookie.split(";");for(e=0;e<o.length;e++){for(n=o[e];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(r))return n.substring(r.length,n.length)}return null}function r(n){n=JSON.stringify(n),"session"==t?window.name=n:e("localStorage",n,365)}function o(){"session"==t?window.name="":e("localStorage","",365)}function i(){var e="session"==t?window.name:n("localStorage");return e?JSON.parse(e):{}}var a=i();return{length:0,clear:function(){a={},this.length=0,o()},getItem:function(t){return void 0===a[t]?null:a[t]},key:function(t){var e=0;for(var n in a){if(e==t)return n;e++}return null},removeItem:function(t){delete a[t],this.length--,r(a)},setItem:function(t,e){a[t]=e+"",this.length++,r(a)}}}function e(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=n.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var n=function(t){if(!t)return!1;try{return t.setItem("a","a"),!0}catch(t){return!1}}(window.localStorage),r={local:n?window.localStorage:new t("local"),session:n?window.sessionStorage:new t("session")},o=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,o){var u={key:t,arg:e,resolve:n,reject:o,next:null};a?a=a.next=u:(i=a=u,r(t,e))})}function r(n,i){try{var a=e[n](i),u=a.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(a.done?"return":"normal",a.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),i=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a="classList"in document.createElement("_"),u="ab-tests",c=function(){},s=function(t,e){return Math.random()*(e-t+t)},l=function(t,e){for(var n=e.reduce(function(t,e){return t+e}),r=0,o=s(0,n),i=0;i<t.length;i+=1)if(r+=e[i],o<=r)return t[i];return""},f=function t(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=f.persist,d=void 0===h||h,v=f.active,y=void 0===v||v,w=f.chosen,p=void 0===w?c:w;o(this,t);var g=s;if(!n)throw new Error("Tests must have a name");if(!y)return{active:!1};var m=r.local.getItem(u);if(m)try{m=JSON.parse(m)}catch(t){m={}}else m={};var b=void 0,k=(e("assign")||"").split(":"),S=i(k,2),x=S[0],I=S[1],O=x===n,T=I in g,j=d&&m[n],E=O&&T||!j;E?!function(){var t=Object.keys(g),e=[];t.forEach(function(t){"undefined"==typeof g[t].weight&&(g[t].weight=1),e.push(g[t].weight)}),b=O&&T?I:l(t,e),m[n]={bucket:b,buckets:Object.keys(g)},r.local.setItem(u,JSON.stringify(m))}():b=m[n].bucket;var N=n+"--"+b;a?document.body.classList.add(N):document.body.className+=" "+N;var _={bucket:b,data:g[b],active:!0};if(g[b]&&(g[b].chosen||(g[b].chosen=c),g[b].chosen.call(this)),p&&p.call(this,_),"undefined"!=typeof dataLayer){var J={abTests:{}};J.abTests[n]=b,dataLayer.push(J)}return _};return f});
