/**
 * studyjs - A client side A/B tester
 * @version v1.1.2
 * @link https://github.com/dollarshaveclub/study
 * @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
 * @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Study=e()}(this,function(){"use strict";function t(t){function e(t,e,n){var r=void 0,i=void 0;n?(r=new Date,r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toGMTString()):i="",document.cookie=t+"="+(e+i)+"; path=/"}function n(t){var e,n,r=t+"=",i=document.cookie.split(";");for(e=0;e<i.length;e++){for(n=i[e];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(r))return n.substring(r.length,n.length)}return null}function r(n){n=JSON.stringify(n),"session"==t?window.name=n:e("localStorage",n,365)}function i(){"session"==t?window.name="":e("localStorage","",365)}function o(){var e="session"==t?window.name:n("localStorage");return e?JSON.parse(e):{}}var a=o();return{length:0,clear:function(){a={},this.length=0,i()},getItem:function(t){return void 0===a[t]?null:a[t]},key:function(t){var e=0;for(var n in a){if(e==t)return n;e++}return null},removeItem:function(t){delete a[t],this.length--,r(a)},setItem:function(t,e){a[t]=e+"",this.length++,r(a)}}}function e(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),r=n.exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var n=function(t){if(!t)return!1;try{return t.setItem("a","a"),!0}catch(t){return!1}}(window.localStorage),r={local:n?window.localStorage:new t("local"),session:n?window.sessionStorage:new t("session")},i=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,i){var s={key:t,arg:e,resolve:n,reject:i,next:null};a?a=a.next=s:(o=a=s,r(t,e))})}function r(n,o){try{var a=e[n](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){r("next",t)},function(t){r("throw",t)}):i(a.done?"return":"normal",a.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):a=null}var o,a;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s="classList"in document.createElement("_"),u="ab-tests",c=function(){},f=function(t,e){return Math.random()*(e-t+t)},l=function(t,e){for(var n=e.reduce(function(t,e){return t+e}),r=0,i=f(0,n),o=0;o<t.length;o+=1)if(r+=e[o],i<=r)return t[o];return""},h=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.persist,a=void 0===o||o,s=r.active,u=void 0===s||s,f=r.chosen,l=void 0===f?c:f;if(i(this,t),!e)throw new Error("Tests must have a name");return this.name=e,this.data=n,this.persist=a,this.active=u,this.chosen=l,this.active?(this.fetchTests(),this.assignBucket(),this.dispatchTest()):{active:!1}}return o(t,[{key:"fetchTests",value:function(){var t=r.local.getItem(u);if(t)try{t=JSON.parse(t)}catch(e){t={}}else t={};this.tests=t}},{key:"assignBucket",value:function t(){var n=this,i=(e("assign")||"").split(":"),o=a(i,2),s=o[0],t=o[1],c=s===this.name,f=t in this.data,h=this.persist&&this.tests[this.name],d=c&&f||!h;d?!function(){var e=Object.keys(n.data),i=[];e.forEach(function(t){"undefined"==typeof n.data[t].weight&&(n.data[t].weight=1),i.push(n.data[t].weight)}),c&&f?n.bucket=t:n.bucket=l(e,i),n.tests[n.name]={bucket:n.bucket,buckets:Object.keys(n.data)},r.local.setItem(u,JSON.stringify(n.tests))}():this.bucket=this.tests[this.name].bucket}},{key:"dispatchTest",value:function(){var t=this.name+"--"+this.bucket;s?document.body.classList.add(t):document.body.className+=" "+t;var e=this.bucket,n={bucket:e,data:this.data[e],active:!0};if(this.data[e]&&(this.data[e].chosen||(this.data[e].chosen=c),this.data[e].chosen.call(this)),this.chosen&&this.chosen.call(this,n),"undefined"!=typeof dataLayer){var r={abTests:{}};r.abTests[this.name]=e,dataLayer.push(r)}return n}}]),t}();return h});
