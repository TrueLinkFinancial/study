/**
 * studyjs - A client side A/B tester
 * @version v2.0.1
 * @link https://github.com/dollarshaveclub/study
 * @author Jacob Kelley <jacob.kelley@dollarshaveclub.com>
 * @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Study=t()}(this,function(){"use strict";var e=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var i={key:e,arg:t,resolve:n,reject:o,next:null};u?u=u.next=i:(s=u=i,r(e,t))})}function r(n,s){try{var u=t[n](s),i=u.value;i instanceof e?Promise.resolve(i.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(u.done?"return":"normal",u.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":s.resolve({value:t,done:!0});break;case"throw":s.reject(t);break;default:s.resolve({value:t,done:!1})}s=s.next,s?r(s.key,s.arg):u=null}var s,u;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=!("undefined"==typeof module||!module.exports),r="ab-tests",o=function(e,t){return Math.random()*(t-e+e)},s=function(e,t){for(var n=t.reduce(function(e,t){return e+t}),r=0,s=o(0,n),u=0;u<e.length;u+=1)if(r+=t[u],s<=r)return e[u];return""},u=function(e){return 1===e.length?e[0]:e},i=function(){function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.store,s=void 0===n?o.stores.local:n;e(this,o),this.store=s,this.userBuckets={},this.userAssignments={},this.providedTests=[];var u=this.store.get(r);if(u)try{this.userBuckets=JSON.parse(u)}catch(e){this.userBuckets={}}}return t(o,[{key:"define",value:function(e){var t=this,n=e;Array.isArray(e)||(n=[e]),n.forEach(function(e){if(!e.name)throw new Error("Tests must have a name");if(!e.buckets)throw new Error("Tests must have buckets");if(!Object.keys(e.buckets))throw new Error("Tests must have buckets");t.providedTests=t.providedTests.concat(e)})}},{key:"definitions",value:function(){return u(this.providedTests)}},{key:"assign",value:function(e,t){var r=this,o=this.assignments();this.providedTests.forEach(function(u){var i=u.name in r.userBuckets,c=t&&e&&e===u.name,a=e&&u.name!==e,f=null===t,l=void 0;a||(f?l=t:c?l=t:i?l=r.userBuckets[u.name]:!function(){var e=Object.keys(u.buckets),t=[];e.forEach(function(e){var n=u.buckets[e].weight;"undefined"==typeof n&&(n=1),t.push(n)}),l=s(e,t)}(),f?(n||document.body.classList.remove(u.name+"--"+o[u.name]),delete r.userAssignments[u.name]):(n||document.body.classList.add(u.name+"--"+l),r.userAssignments[u.name]=l))}),this.persist(this.userAssignments)}},{key:"assignments",value:function(){return this.userAssignments}},{key:"persist",value:function(e){this.store.set(r,JSON.stringify(e))}}]),o}();return i.stores={local:{get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)}},memory:function(){var e={};return{get:function(t){return e[t]},set:function(t,n){e[t]=n}}}(),browserCookie:{get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires=expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"}}},i});
